version: '3.3'
services:
  mdb:  
    env_file: .env
    build: ./mariadb/
    restart: always
    networks:
      - services
    volumes:
      - db_data:/var/mysql/
  wp:
    env_file: .env
    build: ./wordpress/
    networks:
      - services
    volumes:
      - db_data:/var/www/
    depends_on:
      - mdb
    restart: always
  nginx:
    env_file: .env
    build: ./nginx/
    depends_on:
      - wp
    ports:
      - 443:443
    restart: always
    networks:
      - services
    volumes:
      - wp_data:/var/www/
    extra_hosts:
      - "hcherrie.42.fr:127.0.0.1"

networks:
  services:

volumes:
  db_data:
    driver: local
    driver_opts:
      type: "none"
      o: "bind"
      device: "/root/data"
  wp_data:
    driver: local
    driver_opts:
      type: "none"
      o: "bind"
      device: "/root/data"
